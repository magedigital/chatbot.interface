# Bot Construct JS

Bot Construct JS - это визуальный редактор для создания чат-ботов с интуитивным интерфейсом и богатыми возможностями для проектирования логики взаимодействия с пользователями.

## Описание проекта

Bot Construct JS представляет собой мощный инструмент для визуального проектирования чат-ботов. Он позволяет создавать сложные сценарии взаимодействия с пользователями с помощью удобного drag-and-drop интерфейса, без необходимости писать код.

## Функциональность

### Основные возможности:

- **Визуальный редактор**: Интерактивный редактор на базе React Flow для создания и редактирования сценариев чат-бота
- **Управление экранами**: Создание и организация экранов (экранов взаимодействия с пользователем)
- **Управление нодами**: Добавление, редактирование и удаление различных типов нод (элементов взаимодействия)
- **Связи между нодами**: Визуальное создание логических связей между элементами сценария
- **Редактирование свойств**: Возможность настройки различных параметров нод и экранов
- **Загрузка изображений**: Поддержка добавления изображений к нодам и экранам
- **История изменений**: Поддержка undo/redo операций для удобства редактирования
- **Импорт/экспорт данных**: Возможность сохранения и загрузки проектов

### Типы нод:

- **Экраны**: Группирующие элементы для организации логики
- **Кнопки**: Элементы взаимодействия внутри экранов
- **Соединения**: Логические связи между элементами

## Принцип работы

1. **Создание сценария**: Пользователь создает визуальный сценарий взаимодействия, добавляя экраны и ноды
2. **Настройка логики**: Через интерфейс редактирования настраиваются параметры каждого элемента
3. **Создание связей**: Устанавливаются логические связи между элементами для определения потока взаимодействия
4. **Сохранение**: Данные сохраняются в JSON-формате для дальнейшего использования

## Интерфейс

### Основные элементы интерфейса:

- **Верхнее меню**: Содержит основные команды (добавить экран, редактировать, флоу, расположить)
- **Рабочая область**: Центральная область для визуального редактирования сценариев
- **Панель инструментов**: Управление масштабом и навигацией по сцене
- **Диалоги редактирования**: Модальные окна для настройки свойств элементов

### Меню:

- **Добавить экран**: Создание нового экрана взаимодействия
- **Редактировать**: Команды отмены/возврата изменений
- **Флоу**: Экспорт/импорт данных, очистка
- **Расположить**: Автоматическое упорядочивание элементов

## API и интеграция

### Конфигурация

Приложение поддерживает глобальную конфигурацию через объект `window.config` с следующими параметрами:

- `loadUrl`: URL для загрузки данных проекта
- `saveUrl`: URL для сохранения данных проекта
- `publishUrl`: URL для публикации данных проекта
- `commandOptions`: Массив опций для выпадающего списка команд
  ```javascript
  [
    { label: "Без команды", value: "-" },
    { label: "Команда 1", value: "Команда 1" },
    { label: "Команда 2", value: "Команда 2" },
    { label: "Команда 3", value: "Команда 3" },
    { label: "Команда 4", value: "Команда 4" },
    { label: "Команда 5", value: "Команда 5" }
  ]
  ```
- `miniAppOptions`: Массив опций для выпадающего списка мини-приложений
  ```javascript
  [
    { label: "Без мини-приложения", value: "-" },
    { label: "Мини-приложение 1", value: "Мини-приложение 1" },
    { label: "Мини-приложение 2", value: "Мини-приложение 2" }
  ]
  ```
- `userStatusOptions`: Массив опций для выпадающего списка статусов пользователя
  ```javascript
  [
    { label: "Без изменений", value: "-" },
    { label: "Заполнил данные", value: "Заполнил данные" },
    { label: "Загрузил чек", value: "Загрузил чек" },
    { label: "Зарегистрировал код", value: "Зарегистрировал код" }
  ]
  ```

### Формат данных

Данные проекта представлены в JSON-формате со следующими основными полями:

```json
{
  "nodes": [...], // массив нод
  "edges": [...]  // массив связей
}
```

#### Структура нод:
Каждая нода в массиве `nodes` имеет следующую структуру:

```json
{
  "id": "уникальный идентификатор ноды",
  "type": "тип ноды (innerNode, screenGroupNode и т.д.)",
  "position": {
    "x": координата X,
    "y": координата Y
  },
  "data": {
    "label": "название ноды",
    "sendMessage": "сообщение при входе в экран",
    "defaultMessage": "сообщение по умолчанию",
    "goToScreen": "переход к другому экрану",
    "openMiniApp": "открытие мини-приложения",
    "command": "выполнение команды",
    "sendImage": "изображение для отправки",
    "paramsList": [
      {
        "param": "параметр команды",
        "value": "значение параметра"
      }
    ],
    "setUserStatus": "установка статуса пользователя",
    "unsetUserStatus": "снятие статуса пользователя",
    "visibleForStatus": "видимость для статуса",
    "hiddenForStatus": "скрытие для статуса",
    "isStartScreen": "является ли стартовым экраном",
    "isStartScreenNode": "является ли стартовой нодой"
  },
  "width": ширина ноды,
  "height": высота ноды,
  "parentNode": "идентификатор родительской группы (если есть)",
  "draggable": "возможность перетаскивания",
  "selectable": "возможность выделения"
}
```

#### Структура связей:
Каждая связь в массиве `edges` имеет следующую структуру:

```json
{
  "id": "уникальный идентификатор связи",
  "source": "идентификатор исходной ноды",
  "target": "идентификатор целевой ноды",
  "style": {
    "strokeWidth": "толщина линии"
  },
  "markerEnd": {
    "type": "arrowclosed"
  },
  "deletable": "возможность удаления",
  "reconnectable": "возможность переподключения",
  "updatable": "возможность обновления"
}
```

#### Пример полного JSON:
```json
{
  "nodes": [
    {
      "id": "screen-group-1",
      "type": "screenGroupNode",
      "position": { "x": 100, "y": 100 },
      "data": {
        "label": "Стартовый экран",
        "sendMessage": "<p>Добро пожаловать!</p>",
        "isStartScreen": true
      },
      "width": 300,
      "height": 200
    },
    {
      "id": "inner-node-1",
      "type": "innerNode",
      "position": { "x": 50, "y": 50 },
      "data": {
        "label": "Приветствие",
        "sendMessage": "<p>Здравствуйте!</p>",
        "goToScreen": "screen-group-2"
      },
      "width": 150,
      "height": 80,
      "parentNode": "screen-group-1"
    }
  ],
  "edges": [
    {
      "id": "edge-inner-node-1-screen-group-2",
      "source": "inner-node-1",
      "target": "screen-group-2",
      "style": { "strokeWidth": 3 },
      "markerEnd": { "type": "arrowclosed" },
      "deletable": true,
      "reconnectable": true,
      "updatable": true
    }
  ]
}
```

### Интеграция

Для интеграции с внешними системами:

1. Настройте конфигурацию в `window.config`
2. Реализуйте API-эндпоинты для сохранения и загрузки данных
3. Используйте экспорт/импорт функциональность для обмена данными

## Технологии

- **React**: Основной фреймворк
- **React Flow**: Визуальный редактор графов
- **PrimeReact**: Компоненты пользовательского интерфейса
- **Redux Toolkit**: Управление состоянием приложения
- **Redux Undo**: Поддержка операций отмены/возврата
- **Vite**: Сборка и разработка

## Установка и запуск

1. Установите зависимости:

```bash
npm install
```

2. Запустите в режиме разработки:

```bash
npm run dev
```

3. Для сборки продакшн-версии:

```bash
npm run build
```

## Горячие клавиши

- `Ctrl+Z` / `Cmd+Z`: Отменить последнее действие
- `Ctrl+Y` / `Cmd+Y`: Повторить отмененное действие
